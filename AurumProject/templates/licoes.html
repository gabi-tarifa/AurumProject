<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurum</title>
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/128/3975/3975233.png" type="image/x-icon">
    <style>
body {
    background: #0f1e34;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 20px; /* respiro extra */
}
#aula-container {
    width: 600px;
    margin: auto;
    background: #0f1b3d;
    color: white;
    padding: 20px;
    border-radius: 20px;

    box-shadow: 
        0 4px 12px rgba(54, 53, 53, 0.666),   /* sombra padrão */
        0 0 20px rgba(218, 164, 26, 0.588); /* brilho dourado */
}

#progresso {
    width: 100%;
    background: #000000;
    height: 8px;
    border-radius: 4px;
    margin: 10px 0;
}
#barra-progresso {
    height: 100%;
    background: darkgoldenrod;
    width: 0%;
    border-radius: 4px;
    transition: width 0.3s ease;
}
#conteudo {
    margin: 20px 0;
}
#navegacao {
    text-align: right;
}
#navegacao button {
    background: darkgoldenrod;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    cursor: pointer;
}
#navegacao button:disabled {
    background: rgb(104, 77, 7);
    cursor: not-allowed;
}
#conteudo button {
    display: block;
    margin: 8px 0;
    padding: 10px;
    background: #2b3d74;
    color: white;
    border: 2px solid #2f3b74;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.5s ease, border-color 0.5s ease;
}
#conteudo button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}
</style>
</head>
<body>
    <div id="aula-container">
  <h2 id="aula-titulo">{{ tarefa.descricao }}</h2>
  <div id="progresso">
    <div id="barra-progresso"></div>
  </div>

  <div id="conteudo"></div>

  <div id="navegacao">
    <button id="btn-voltar" disabled>{{ _('Voltar') }}</button>
    <button id="btn-avancar">{{ _('Avançar') }}</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const blocos = {{ blocos_json|tojson }};
    
    const tarefaId = {{ tarefa.id_tarefa }};

    const moduloId = {{ tarefa.id_modulo }};

    let indice = 0;
    const conteudoEl = document.getElementById("conteudo");
    const barraProgresso = document.getElementById("barra-progresso");
    const btnAvancar = document.getElementById("btn-avancar");
    const btnVoltar = document.getElementById("btn-voltar");

    function renderizarBloco() {
        const bloco = blocos[indice];
        barraProgresso.style.width = ((indice) / blocos.length * 100) + "%";

        if (bloco.tipo === "texto") {
            conteudoEl.innerHTML = bloco.conteudo;
            btnAvancar.disabled = false;
            btnVoltar.disabled = false
        } else if (bloco.tipo === "quiz") {
            conteudoEl.innerHTML = `<h3>${bloco.pergunta}</h3>`;
            bloco.alternativas.forEach((alt, i) => {
                const btn = document.createElement("button");
                btn.textContent = alt.texto;
    btn.onclick = () => {
    // reseta estilos anteriores (pra não acumular)
    [...conteudoEl.querySelectorAll("button")].forEach(b => {
        b.style.background = "#2b3d74";
        b.style.borderColor = "#2f3b74";
    });

    if (alt.correta) {
        btn.style.background = "green";
        btn.style.borderColor = "darkgreen";
        btnAvancar.disabled = false;
        btnVoltar.disabled = false;
            // desabilita todas as alternativas
            let botoes = document.querySelectorAll("#conteudo button");
            botoes.forEach(b => b.disabled = true);
    } else {
        btn.style.background = "crimson";
        btn.style.borderColor = "darkred";
        btnVoltar.disabled = false;
    }
};
                conteudoEl.appendChild(btn);
            });
            btnAvancar.disabled = true;
            btnVoltar.disabled = true;
        }
    }

    btnAvancar.addEventListener("click", () => {
        if (indice < blocos.length - 1) {
            indice++;
            renderizarBloco();
        } else {
            fetch(`/concluir_tarefa/${tarefaId}`, { method: "POST" })
                .then(() => {
                    alert({{ _('Aula concluída!')|tojson }});
                    window.location.href = `/modulo_${moduloId}`;// volta para o mapa
                })
                .catch(() => {
                    alert({{ _('Erro ao concluir a aula.')|tojson }});
                });
        }
    });   
    btnVoltar.addEventListener("click", () => {
        if (indice > 0) {
            indice--;
            renderizarBloco();
        }
    });

    renderizarBloco();
});
</script>
</body>

</html>