<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes - Aurum</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/configuracoes.css') }}">
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/128/3975/3975233.png" type="image/x-icon">
</head>
<body {%if tema_atual == 'cla'%} class="claro" {%endif%}>

    <header {%if tema_atual == 'cla'%} class="claro" {%endif%}>
<a href = "{{ url_for('starting_page') }}">‚Üê {{ _(' Voltar') }}</a>

        <h1>{{ _('Configura√ß√µes') }}</h1>
        <div></div>
    </header>

    <main>
        <section class="config-section {%if tema_atual == 'cla'%} claro {%endif%}">
            <h2>{{ _('Prefer√™ncias') }}</h2>
            <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">
                <label for="sound">{{ _('Sons') }}</label>
                <input type="checkbox" id="sound" {% if sons %} checked {% endif %}>
            </div>
            <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">
                <label for="music">{{ _('M√∫sica de fundo') }}</label>
                <input type="checkbox" id="music" {% if musica %} checked {% endif %}>
            </div>
            <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}" id = "volume-musica">
              <label for="volume-musica">Volume</label>
              <input 
                type="range" 
                id="range_musica" 
                min="0" 
                max="100" 
                value="{{ volume_musica }}" 
              >
            </div>
            <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">
    <label for="musica">{{ _('M√∫sicas') }}</label>
    <select {%if tema_atual == 'cla'%} class="claro" {%endif%} id="musica">
    </select>
      <img id="btn-excluir-musica" src="{{ url_for('static', filename='img/bin.png') }}" alt="Excluir" title="Excluir m√∫sica"
       style="width: 22px; height: 22px; cursor: pointer; display: none;">
    </div>
            <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">
    <label for="idioma">{{ _('Idioma') }}</label>
    <select {%if tema_atual == 'cla'%} class="claro" {%endif%} id="idioma" data-url="{{ url_for('api_idioma') }}">
        {% for lang in idiomas %}
        {% set sel = 'selected' if lang.code == idioma else '' %}
            <option {%if tema_atual == 'cla'%} class="claro" {%endif%} value="{{ lang.code }}" {{ sel }}>
                {{ lang.name }}
            </option>
        {% endfor %}

    </select>
    </div>
<div id="painel-musica" class="painel-edicao oculto {%if tema_atual == 'cla'%} claro {%endif%}" >
    <form action="{{ url_for('upload_musica') }}" enctype="multipart/form-data" method="post">
  <h3>Adicionar M√∫sica</h3>
  <label for="nomemusica">Nome:</label>
  <input type="text" name="nomemusica" placeholder="Nome da m√∫sica" required><br><br>
  
  <label for="arquivo">Arquivo:</label>
  <input type="file" name="arquivo" accept=".mp3, .wav" required><br><br>
  <div class="botoes">
  <button id="salvarMusicaUser" type="submit" class="selecionar">Adicionar</button>
  <button id="cancelarMusicaUser" type="button" class="selecionar", onclick="fecharDiv('painel-musica')">Cancelar</button>
</div>
</form>
</div>
    <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">    
    <label for="tema">{{ _('Tema') }}</label>
    <select {%if tema_atual == 'cla'%} class="claro" {%endif%} id="tema" data-url="{{ url_for('api_tema') }}">
        {% for tema in temas %}
        {% set tem = 'selected' if tema.code == tema_atual else '' %}
            <option {%if tema_atual == 'cla'%} class="claro" {%endif%} value="{{ tema.code }}" {{ tem }}>
                {{ tema.name }}
            </option>
        {% endfor %}

    </select>
    </div>
        </section>

<section class="config-section {%if tema_atual == 'cla'%} claro {%endif%}">
    <h2>{{ _('Conta') }}</h2>

    <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">
        <label>{{ _('Alterar Apelido') }}</label>
        <button onclick="abrirDiv('painel-apelido')">{{ _('Editar') }}</button>
    </div>
    <div id="painel-apelido" class="painel-edicao oculto {%if tema_atual == 'cla'%} claro {%endif%}">
        <form onsubmit="salvarApelido(); return false;">
            <h2>{{ _('Alterar Apelido') }}</h2>
            <label for="novo-apelido">{{ _('Novo Apelido:') }}</label>
            <input type="text" id="novo-apelido" name="novo-apelido" placeholder="{{ _('Digite o novo apelido') }}" value="{{ usuario.nome }}" required>
            
            <div class="botoes">
                <button class="selecionar" type="submit">{{ _('Salvar') }}</button>
                <button class="selecionar" type="button" onclick="fecharDiv('painel-apelido')">{{ _('Cancelar') }}</button>
            </div>
        </form>
    </div>

    <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">
        <label>{{ _('Alterar Email Cadastrado') }}</label>
        <button onclick="abrirDiv('painel-email')">{{ _('Editar') }}</button>
    </div>
    <div id="painel-email" class="painel-edicao oculto {%if tema_atual == 'cla'%} claro {%endif%}">
        <form onsubmit="salvarEmail(); return false;">
            <h2>{{ _('Alterar Email') }}</h2>
            <label for="novo-email">{{ _('Novo Email:') }}</label>
            <input type="email" id="novo-email" name="novo-email" placeholder="{{ _('Digite o novo email') }}" value="{{ usuario.email }}" required>
            
            <div class="botoes">
                <button class="selecionar" type="submit">{{ _('Salvar') }}</button>
                <button class="selecionar" type="button" onclick="fecharDiv('painel-email')">{{ _('Cancelar') }}</button>
            </div>
        </form>
    </div>

    <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">
        <label>{{ _('Alterar Senha') }}</label>
        <button onclick="abrirDiv('painel-senha')">{{ _('Editar') }}</button>
    </div>
    <div id="painel-senha" class="painel-edicao oculto {%if tema_atual == 'cla'%} claro {%endif%}">
        <form onsubmit="salvarSenha(); return false;">
            <h2>{{ _('Alterar Senha') }}</h2>
            <label for="senha-atual">{{ _('Senha Atual:') }}</label>
            <input type="password" id="senha-atual" name="senha-atual" required><br>

            <label for="nova-senha">{{ _('Nova Senha:') }}</label>
            <input type="password" id="nova-senha" name="nova-senha" required><br>

            <label for="confirmar-senha">{{ _('Confirmar Nova Senha:') }}</label>
            <input type="password" id="confirmar-senha" name="confirmar-senha" required>
            
            <span id="textoerro" class="textoerro"></span><br>
            
            <div class="botoes">
                <button class="selecionar" type="submit">{{ _('Salvar') }}</button>
                <button class="selecionar" type="button" onclick="fecharDiv('painel-senha')">{{ _('Cancelar') }}</button>
            </div>
        </form>
    </div>
</section>

        <section class="config-section {%if tema_atual == 'cla'%} claro {%endif%}">
            <h2>{{ _('Aplicativo') }}</h2>
            <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">
                <label>{{ _('Vers√£o do App') }}</label>
                <span>0.3.3.1.1 Beta</span>
            </div>
            <div class="config-item {%if tema_atual == 'cla'%} claro {%endif%}">
                <label>{{ _('Redefinir configura√ß√µes') }}</label>
                <button onclick="resetarConfig()">{{ _('Resetar') }}</button>
            </div>
        </section>
    </main>
    <!-- üî∏ Modal de confirma√ß√£o de exclus√£o -->
<div id="modal-excluir" class="modal-excluir" style="display: none;">
  <div class="modal-conteudo {%if tema_atual == 'cla'%} claro {%endif%}">
    <p id="modal-texto">Tem certeza que deseja excluir esta m√∫sica?</p>
    <div class="botoes-modal">
      <button id="btn-confirmar-exclusao" class="btn-confirmar">Excluir</button>
      <button id="btn-cancelar-exclusao" class="btn-cancelar">Cancelar</button>
    </div>
  </div>
</div>
    
    <script>
  // valor inicial vindo do backend, s√≥ na primeira vez
  const sonsIniciais = {{ 'true' if sons_ativos else 'false' }};
  // se j√° tiver no localStorage, usa ele; sen√£o, define o inicial
  if (localStorage.getItem('sons_ativos') === null) {
    localStorage.setItem('sons_ativos', sonsIniciais ? 'true' : 'false');
  }
  window.SONS_ATIVOS = localStorage.getItem('sons_ativos') == 'true';
  // Valor din√¢mico vindo do backend
  window.MUSICA_ATIVA = {{ 'true' if musica_ativa else 'false' }};
  const musicasUsuario = {{ musicas_usuario | tojson | safe }};
  const musicadasessao = {{ musica_tocada | tojson }};
  const volumeMusicaBanco = {{ volume_musica }}
  
</script>
    <script src="{{ url_for('static', filename='js/sounds.js') }}"></script>
    <script src="{{ url_for('static', filename='js/musics.js') }}"></script>
    <script src="{{ url_for('static', filename='js/configuracoes.js') }}"></script>

</body>
</html>